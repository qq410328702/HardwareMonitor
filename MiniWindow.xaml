<Window x:Class="HardwareMonitor.MiniWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:HardwareMonitor.Converters"
        Title="Monitor" Width="300" Height="175"
        WindowStyle="None" AllowsTransparency="True"
        Topmost="True" ShowInTaskbar="False"
        ResizeMode="NoResize" Background="Transparent">

    <Window.Resources>
        <conv:FloatFormatConverter x:Key="FloatFmt"/>
    </Window.Resources>

    <Border CornerRadius="16" BorderBrush="{DynamicResource MiniBorderBrush}" BorderThickness="1"
            Background="{DynamicResource MiniBgBrush}">
        <Border.Effect>
            <DropShadowEffect BlurRadius="24" ShadowDepth="2" Opacity="0.4" Color="Black"/>
        </Border.Effect>

        <Grid>
            <!-- Drag overlay -->
            <Border Background="Transparent"
                    MouseLeftButtonDown="DragArea_MouseDown"
                    MouseRightButtonDown="DragArea_MouseRightDown"
                    Panel.ZIndex="0"/>

            <Grid Margin="16,12" Panel.ZIndex="1" IsHitTestVisible="False">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="6"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal">
                    <Ellipse Width="8" Height="8" Margin="0,0,8,0">
                        <Ellipse.Fill>
                            <RadialGradientBrush>
                                <GradientStop Color="#FF4ADE80" Offset="0"/>
                                <GradientStop Color="#FF22C55E" Offset="1"/>
                            </RadialGradientBrush>
                        </Ellipse.Fill>
                    </Ellipse>
                    <TextBlock Text="Hardware Monitor" FontSize="12" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextPrimaryBrush}" Opacity="0.7"/>
                </StackPanel>

                <!-- Stats -->
                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="6"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="6"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- CPU -->
                    <Border Grid.Column="0" Grid.Row="0" CornerRadius="10" Padding="12,8"
                            Background="{DynamicResource MiniCardBrush}">
                        <StackPanel>
                            <TextBlock Text="CPU" FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontWeight="Bold" Margin="0,0,0,4"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontSize="22" FontWeight="Bold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           Text="{Binding CpuTemp, Converter={StaticResource FloatFmt}, ConverterParameter=F0}"/>
                                <TextBlock Text="°" FontSize="14" Foreground="{DynamicResource TextSecondaryBrush}"
                                           VerticalAlignment="Top" Margin="1,2,0,0"/>
                                <TextBlock FontSize="22" FontWeight="Bold"
                                           Foreground="{DynamicResource AccentBlueBrush}"
                                           Text="{Binding CpuUsage, Converter={StaticResource FloatFmt}, ConverterParameter=F0}"
                                           Margin="10,0,0,0"/>
                                <TextBlock Text="%" FontSize="11" Foreground="{DynamicResource AccentBlueBrush}"
                                           VerticalAlignment="Bottom" Margin="1,0,0,4"/>
                            </StackPanel>
                            <Grid Height="3" Margin="0,5,0,0">
                                <Border Background="{DynamicResource MiniBarBgBrush}" CornerRadius="2"/>
                                <Border Background="{DynamicResource AccentBlueBrush}" CornerRadius="2"
                                        HorizontalAlignment="Left" x:Name="CpuBar"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- GPU -->
                    <Border Grid.Column="2" Grid.Row="0" CornerRadius="10" Padding="12,8"
                            Background="{DynamicResource MiniCardBrush}">
                        <StackPanel>
                            <TextBlock Text="GPU" FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontWeight="Bold" Margin="0,0,0,4"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontSize="22" FontWeight="Bold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           Text="{Binding GpuTemp, Converter={StaticResource FloatFmt}, ConverterParameter=F0}"/>
                                <TextBlock Text="°" FontSize="14" Foreground="{DynamicResource TextSecondaryBrush}"
                                           VerticalAlignment="Top" Margin="1,2,0,0"/>
                                <TextBlock FontSize="22" FontWeight="Bold"
                                           Foreground="{DynamicResource AccentGreenBrush}"
                                           Text="{Binding GpuUsage, Converter={StaticResource FloatFmt}, ConverterParameter=F0}"
                                           Margin="10,0,0,0"/>
                                <TextBlock Text="%" FontSize="11" Foreground="{DynamicResource AccentGreenBrush}"
                                           VerticalAlignment="Bottom" Margin="1,0,0,4"/>
                            </StackPanel>
                            <Grid Height="3" Margin="0,5,0,0">
                                <Border Background="{DynamicResource MiniBarBgBrush}" CornerRadius="2"/>
                                <Border Background="{DynamicResource AccentGreenBrush}" CornerRadius="2"
                                        HorizontalAlignment="Left" x:Name="GpuBar"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- RAM -->
                    <Border Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="2"
                            CornerRadius="10" Padding="12,7"
                            Background="{DynamicResource MiniCardBrush}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="RAM" FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,12,0"/>
                            <Grid Grid.Column="1" VerticalAlignment="Center" Height="3">
                                <Border Background="{DynamicResource MiniBarBgBrush}" CornerRadius="2"/>
                                <Border CornerRadius="2" HorizontalAlignment="Left" x:Name="MemBar"
                                        Background="{DynamicResource AccentPurpleBrush}"/>
                            </Grid>
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="12,0,0,0">
                                <TextBlock FontSize="15" FontWeight="Bold"
                                           Foreground="{DynamicResource AccentPurpleBrush}"
                                           Text="{Binding MemUsage, Converter={StaticResource FloatFmt}, ConverterParameter=F0}"
                                           VerticalAlignment="Center"/>
                                <TextBlock Text="%" FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}"
                                           VerticalAlignment="Center" Margin="2,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>

                <!-- Hint -->
                <TextBlock Grid.Row="4" Text="拖拽移动 · 右键关闭" FontSize="9"
                           Foreground="{DynamicResource MiniHintBrush}" HorizontalAlignment="Center"/>
            </Grid>

            <!-- Buttons -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top"
                        Margin="0,10,14,0" Panel.ZIndex="2">
                <Button Content="□" Click="Expand_Click" Style="{x:Null}"
                        Width="24" Height="22" FontSize="10" Cursor="Hand" ToolTip="展开主窗口"
                        Background="Transparent" Foreground="{DynamicResource TextSecondaryBrush}"
                        BorderThickness="0" IsHitTestVisible="True"/>
                <Button Content="✕" Click="Close_Click" Style="{x:Null}"
                        Width="24" Height="22" FontSize="11" Cursor="Hand"
                        Background="Transparent" Foreground="{DynamicResource TextSecondaryBrush}"
                        BorderThickness="0" IsHitTestVisible="True"/>
            </StackPanel>
        </Grid>
    </Border>
</Window>
